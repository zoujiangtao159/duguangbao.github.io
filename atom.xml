<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>duguangbao&#39;s blogs</title>
  
  <subtitle>喜欢折腾的学生狗一只</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://duguangbao.github.io/"/>
  <updated>2018-08-16T23:48:12.096Z</updated>
  <id>https://duguangbao.github.io/</id>
  
  <author>
    <name>duguangbao</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>爬取豆瓣音乐top250的数据</title>
    <link href="https://duguangbao.github.io/2018/08/16/%E7%88%AC%E5%8F%96%E8%B1%86%E7%93%A3%E9%9F%B3%E4%B9%90top250%E7%9A%84%E6%95%B0%E6%8D%AE/"/>
    <id>https://duguangbao.github.io/2018/08/16/爬取豆瓣音乐top250的数据/</id>
    <published>2018-08-16T01:27:16.303Z</published>
    <updated>2018-08-16T23:48:12.096Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="此次将利用Requests-lxml和re库爬取豆瓣音乐top250的数据，并存入mongodb数据库中"><a href="#此次将利用Requests-lxml和re库爬取豆瓣音乐top250的数据，并存入mongodb数据库中" class="headerlink" title="此次将利用Requests,lxml和re库爬取豆瓣音乐top250的数据，并存入mongodb数据库中"></a>此次将利用Requests,lxml和re库爬取豆瓣音乐top250的数据，并存入mongodb数据库中</h2><h2 id="爬虫思路"><a href="#爬虫思路" class="headerlink" title="爬虫思路"></a>爬虫思路</h2><h3 id="确定爬取信息"><a href="#确定爬取信息" class="headerlink" title="确定爬取信息"></a>确定爬取信息</h3><p>爬取的信息有：歌曲名，表演者，流派，发行时间，出版者，评分，如下图所示：</p><h3 id="使用浏览器手动浏览，以下为前四页的网址："><a href="#使用浏览器手动浏览，以下为前四页的网址：" class="headerlink" title="使用浏览器手动浏览，以下为前四页的网址："></a>使用浏览器手动浏览，以下为前四页的网址：</h3><blockquote><p><a href="https://music.douban.com/top250" target="_blank" rel="noopener">https://music.douban.com/top250</a><br><a href="https://music.douban.com/top250?start=25" target="_blank" rel="noopener">https://music.douban.com/top250?start=25</a><br><a href="https://music.douban.com/top250?start=50" target="_blank" rel="noopener">https://music.douban.com/top250?start=50</a><br><a href="https://music.douban.com/top250?start=75" target="_blank" rel="noopener">https://music.douban.com/top250?start=75</a><br>然后将第一页的网址改为：<br><a href="https://music.douban.com/top250?start=0" target="_blank" rel="noopener">https://music.douban.com/top250?start=0</a><br>也可以正常浏览，可知只需更改<a href="https://music.douban.com/top250?start=后的数字就好" target="_blank" rel="noopener">https://music.douban.com/top250?start=后的数字就好</a></p></blockquote><h3 id="需要爬取的信息在top250页面并不全面，所以需要先爬取进入详细页的网址链接，然后再进入详细页进行爬取，详见爬虫代码"><a href="#需要爬取的信息在top250页面并不全面，所以需要先爬取进入详细页的网址链接，然后再进入详细页进行爬取，详见爬虫代码" class="headerlink" title="需要爬取的信息在top250页面并不全面，所以需要先爬取进入详细页的网址链接，然后再进入详细页进行爬取，详见爬虫代码"></a>需要爬取的信息在top250页面并不全面，所以需要先爬取进入详细页的网址链接，然后再进入详细页进行爬取，详见爬虫代码</h3><h3 id="最后使用pymongo库将爬取到的信息存入数据库"><a href="#最后使用pymongo库将爬取到的信息存入数据库" class="headerlink" title="最后使用pymongo库将爬取到的信息存入数据库"></a>最后使用pymongo库将爬取到的信息存入数据库</h3><h2 id="爬虫代码及分析"><a href="#爬虫代码及分析" class="headerlink" title="爬虫代码及分析"></a>爬虫代码及分析</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#导入相应的库文件</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"><span class="comment">#连接数据库，创建数据库和数据集合</span></span><br><span class="line">client = pymongo.MongoClient(<span class="string">'localhost'</span>,<span class="number">27017</span>)</span><br><span class="line">mydb = client[<span class="string">'mydb'</span>]</span><br><span class="line">musictop = mydb[<span class="string">'musictop'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#加入请求头</span></span><br><span class="line">headers = &#123;</span><br><span class="line">        Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">68.0</span><span class="number">.3440</span><span class="number">.75</span> Safari/<span class="number">537.36</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">#在自己浏览器中输入about:version即可查看相关信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义获取豆瓣音乐的详细url的函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_url_music</span><span class="params">(url)</span>:</span></span><br><span class="line">    html = requests.get(url,headers = headers)</span><br><span class="line">    selector = etree.HTML(html.text)</span><br><span class="line">    music_hrefs = selector.xpath(<span class="string">'//a[@class="nbg"]/@href'</span>) <span class="comment">#xpath语法</span></span><br><span class="line">    <span class="keyword">for</span> music_href <span class="keyword">in</span> music_hrefs:</span><br><span class="line">        get_music_info(music_href)</span><br><span class="line">        </span><br><span class="line"><span class="comment">#定义获取详细信息的函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_music_info</span><span class="params">(url)</span>:</span></span><br><span class="line">    res = requests.get(url,headers = headers)</span><br><span class="line">    sele = etree.HTML(res.text)</span><br><span class="line">    name = sele.xpath(<span class="string">'//*[@id="wrapper"]/h1/span/text()'</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="comment">#详细页信息略有不同，若采用定位标签的方法获取信息，可能会有一些详细信息匹配错误，更好的方法是使用正则表达式进行匹配</span></span><br><span class="line">    author = re.findall(<span class="string">'表演者:.*?&gt;(.*?)&lt;/a&gt;'</span>,res.text,re.S)[<span class="number">0</span>]</span><br><span class="line">    流派，发行时间出版信息使用的也是正则表达式，因为在这里使用xpath较乱，此处多个标签相互嵌套，还有一些乱码的符号（主要是我懒^^）</span><br><span class="line">    styles = re.findall(<span class="string">'&lt;span class="pl"&gt;流派:&lt;/span&gt;&amp;nbsp;(.*?)&lt;br'</span>,res.text,re.S)</span><br><span class="line">    <span class="keyword">if</span> len(styles) == <span class="number">0</span>:</span><br><span class="line">        style = <span class="string">'未知'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        style = styles[<span class="number">0</span>].strip()</span><br><span class="line">    time = re.findall(<span class="string">'&lt;span class="pl"&gt;发行时间:&lt;/span&gt;&amp;nbsp;(.*?)&lt;br'</span>,res.text,re.S)[<span class="number">0</span>].strip()</span><br><span class="line">    publishers = re.findall(<span class="string">'&lt;span class="pl"&gt;出版者:&lt;/span&gt;.*?;(.*?)&lt;br'</span>,res.text,re.S)</span><br><span class="line">    <span class="keyword">if</span> len(publishers) == <span class="number">0</span>:</span><br><span class="line">        publisher = <span class="string">'未知'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        publisher = publishers[<span class="number">0</span>].strip()</span><br><span class="line">    score = sele.xpath(<span class="string">'//*[@id="interest_sectl"]/div/div[2]/strong/text()'</span>)[<span class="number">0</span>]</span><br><span class="line">    print(name,author,style,time,publisher,score)</span><br><span class="line">    info = &#123;</span><br><span class="line">        <span class="string">'name'</span>:name,</span><br><span class="line">        <span class="string">'author'</span>:author,</span><br><span class="line">        <span class="string">'style'</span>:style,</span><br><span class="line">        <span class="string">'time'</span>:time,</span><br><span class="line">        <span class="string">'publisher'</span>:publisher,</span><br><span class="line">        <span class="string">'score'</span>:score</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#插入数据</span></span><br><span class="line">    musictop.insert_one(info)</span><br><span class="line"></span><br><span class="line"><span class="comment">#主函数入口</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment">#构造十个url并依次调用函数</span></span><br><span class="line">    urls = [<span class="string">'https://music.douban.com/top250?start=&#123;&#125;'</span>.format(str(i)) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">250</span>,<span class="number">25</span>)]</span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">        get_url_music(url)</span><br><span class="line">        <span class="comment">#显示进程，可在其他地方输出相关信息</span></span><br><span class="line">        print(<span class="string">'papapapapapapapapapapapapapapapapapapapapapapapapapapapapaapapapapa'</span>)</span><br><span class="line">        <span class="comment">#每循环一次让程序暂停一秒</span></span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>另外文章内涉及到数据库，正则式和xpath语法之类的各位看官可以百度一下网上有不少教程，而且并不是很难&lt;^^&gt;(正则表达式除外，我现在还没学会qq)</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="python" scheme="https://duguangbao.github.io/categories/python/"/>
    
      <category term="爬虫" scheme="https://duguangbao.github.io/categories/python/%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="python" scheme="https://duguangbao.github.io/tags/python/"/>
    
      <category term="爬虫" scheme="https://duguangbao.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="计算机语言" scheme="https://duguangbao.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%AD%E8%A8%80/"/>
    
  </entry>
  
  <entry>
    <title>markdown的简单使用</title>
    <link href="https://duguangbao.github.io/2018/08/15/markdown%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <id>https://duguangbao.github.io/2018/08/15/markdown的简单使用/</id>
    <published>2018-08-15T13:27:51.231Z</published>
    <updated>2018-08-19T02:24:59.497Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="写在前面："><a href="#写在前面：" class="headerlink" title="写在前面："></a>写在前面：</h2><p>本文只记录了自己学习markdown的一点，如果您看到这篇文章并有所收获，我将倍感荣幸，如有错误欢迎指正。</p><p>  markdown是一种方便记忆和书写的纯文本标记语言，作者可以使用简单的标记符号对文本达到自己想要的效果，例如：在word中想要达到给字体加粗的效果可以将字体选中然后shu’biao鼠标点选进行加粗，而在markdown中则可以使用<strong>粗体</strong>这样来表示**<strong>粗体</strong>**，这样就可更好的使用键盘而不必再去点选鼠标</p><h3 id="标题"><a href="#标题" class="headerlink" title="标题"></a>标题</h3><p>markdown支持两种标题的语法</p><blockquote><p>类setext形式<br>atx形式</p></blockquote><h4 id="类-Setext-形式是用底线的形式，利用-（最高阶标题）和-（第二阶标题），例如："><a href="#类-Setext-形式是用底线的形式，利用-（最高阶标题）和-（第二阶标题），例如：" class="headerlink" title="类 Setext 形式是用底线的形式，利用 = （最高阶标题）和 - （第二阶标题），例如："></a>类 Setext 形式是用底线的形式，利用 = （最高阶标题）和 - （第二阶标题），例如：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; title 1</span><br><span class="line">&gt;</span><br><span class="line">&gt; ======</span><br><span class="line">&gt; title 2</span><br><span class="line">&gt; -----</span><br></pre></td></tr></table></figure><p>任何数量的=和-都是有效的</p><p>类Atx形式则是在行首插入1至6个#来对应1到6阶标题，eg：<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">#   H1</span></span><br><span class="line"><span class="section">##   H2</span></span><br><span class="line"><span class="section">######  H6</span></span><br></pre></td></tr></table></figure></p><p>当然你也可以在行尾加上#将其闭合，而#数量也不用和开头一样</p><h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><p>Markdown使用的是类似email中的”&gt;”的应用方式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="quote">&gt; 引用一</span></span><br><span class="line"><span class="quote">&gt; 引用二</span></span><br><span class="line">引用三</span><br><span class="line"><span class="quote">&gt; 引用四</span></span><br><span class="line"><span class="quote">&gt; </span></span><br><span class="line"><span class="quote">&gt; &gt; 嵌套一</span></span><br><span class="line"><span class="quote">&gt; &gt; 嵌套二</span></span><br></pre></td></tr></table></figure><p>可以看到markdown可以允许只在段落首行添加引用，而引用也可以进行嵌套</p><p>引用的区块内也可以使用markdown的其他语法，包括标题，列表，和代码等</p><h3 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h3><p>markdown支持有序和无序列表</p><p>无序列表使用*，+，-作为列表标记<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* r</span><br><span class="line">* g</span><br><span class="line">* b</span><br></pre></td></tr></table></figure></p><p>同样可以使用 +，- 替换上面的 *</p><p>有序列表则使用数字接着一个英文句点<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. r</span><br><span class="line">2. g</span><br><span class="line">3. b</span><br></pre></td></tr></table></figure></p><p>注：列表项目标记通常是放在最左边，但是其实也可以缩进，最多 3 个空格，项目标记后面则一定要接着至少一个空格或制表符</p><p>注：列表项目可以包含多个段落，每个项目下的段落都必须缩进 4 个空格或是 1 个制表符</p><p>如果要在列表项目内放进引用，那 &gt; 就需要缩进,如果要放代码区块的话，该区块就需要缩进两次，也就是 8 个空格或是 2 个制表符</p><h3 id="引入代码"><a href="#引入代码" class="headerlink" title="引入代码"></a>引入代码</h3><p>要在 Markdown 中建立代码区块很简单，只要简单地缩进 4 个空格或是 1 个制表符就可以，也可以使用```……..```注释来使用，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```python</span><br><span class="line">mamamama</span><br><span class="line">mamamama</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">其中的mamamama代码则使用python的格式</span><br><span class="line"></span><br><span class="line">### 分割线</span><br><span class="line">可以在一行中用三个以上的星号、减号、底线来建立一个分隔线，行内不能有其他东西。你也可以在星号或是减号中间插入空格。下面每种写法都可以建立分隔线</span><br><span class="line"></span><br><span class="line">```markdown</span><br><span class="line">***</span><br><span class="line">---</span><br><span class="line">- - -</span><br></pre></td></tr></table></figure><h3 id="插入图片"><a href="#插入图片" class="headerlink" title="插入图片"></a>插入图片</h3><p>参考使用：<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![<span class="string">image</span>](<span class="link">url "title"</span>)</span><br></pre></td></tr></table></figure></p><p>详细叙述如下：</p><pre><code>&gt;  一个惊叹号 !      接着一个方括号，里面放上图片的替代文字    接着一个普通括号，里面放上图片的网址，最后还可以用引号包住并加上 选择性的 &apos;title&apos; 文字。</code></pre><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><h4 id="文本或者图片的控制"><a href="#文本或者图片的控制" class="headerlink" title="文本或者图片的控制"></a>文本或者图片的控制</h4><p>markdown目前无法做到指定图片的宽高，如果你需要的话，你可以使用普通的 <img> 标签。<br>markdown也无法使用给类似标题文本居中的功能，但是这些功能都可以使用html文本添加，例如居中使用可以这样做：</p><ul><li><center>居中</center></li></ul><h4 id="反斜杠"><a href="#反斜杠" class="headerlink" title="反斜杠"></a>反斜杠</h4><p>Markdown 支持以下这些符号前面加上反斜杠来帮助插入普通的符号：</p><blockquote><p>\<br>`<br>*<br>_<br>{}<br>()<br>#<br>+<br>-<br>.<br>!</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="markdown" scheme="https://duguangbao.github.io/categories/markdown/"/>
    
    
      <category term="markdown" scheme="https://duguangbao.github.io/tags/markdown/"/>
    
  </entry>
  
  <entry>
    <title>python + selenium +chrome爬取qq空间好友说说并存入mongodb数据库</title>
    <link href="https://duguangbao.github.io/2018/08/15/python%20+%20selenium%20+chrome%E7%88%AC%E5%8F%96qq%E7%A9%BA%E9%97%B4%E5%A5%BD%E5%8F%8B%E8%AF%B4%E8%AF%B4%E5%B9%B6%E5%AD%98%E5%85%A5mongodb%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    <id>https://duguangbao.github.io/2018/08/15/python + selenium +chrome爬取qq空间好友说说并存入mongodb数据库/</id>
    <published>2018-08-15T13:25:47.946Z</published>
    <updated>2018-08-16T23:49:03.785Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="准备阶段"><a href="#准备阶段" class="headerlink" title="准备阶段"></a>准备阶段</h2><pre><code>在正式开始在前需要先准备好做爬虫的工具，本例使用chrome无头浏览器进行爬取工作，也可使用其他浏览器，程序中的其他可替代工具在此之后不再一一赘述，有一些不明白的地方可以自行百度，有错误的地方欢迎大家指正，大家共同学习共同进步！！</code></pre><h3 id="需要用到的库"><a href="#需要用到的库" class="headerlink" title="需要用到的库:"></a>需要用到的库:</h3><blockquote><p>pymongo<br>selenium<br>csv<br>time</p></blockquote><h2 id="爬虫思路分析"><a href="#爬虫思路分析" class="headerlink" title="爬虫思路分析"></a>爬虫思路分析</h2><blockquote><p>从csv文件读取好友qq号码构造url链接<br>使用chrome + selenium登录QQ，选择账号密码的等率方式<br>爬取好友说说的发表的时间信息<br>把爬取到的信息存储在mongodb中</p></blockquote><h3 id="从qq邮箱获取好友列表，存储为csv文件"><a href="#从qq邮箱获取好友列表，存储为csv文件" class="headerlink" title="从qq邮箱获取好友列表，存储为csv文件"></a>从qq邮箱获取好友列表，存储为csv文件</h3><pre><code>打开qq邮箱选择通讯录 &gt; 工具 &gt; 导出联系人文件选择部分好友文件导出，保存为csv文件，之后便于从csv文件读取好友qq号</code></pre><h3 id="qq空间好友说说的链接为http-user-qzone-qq-com-好友qq号码-311，首次打开需登录"><a href="#qq空间好友说说的链接为http-user-qzone-qq-com-好友qq号码-311，首次打开需登录" class="headerlink" title="qq空间好友说说的链接为http://user.qzone.qq.com/{好友qq号码}/311，首次打开需登录"></a>qq空间好友说说的链接为<a href="http://user.qzone.qq.com/{好友qq号码}/311，首次打开需登录" target="_blank" rel="noopener">http://user.qzone.qq.com/{好友qq号码}/311，首次打开需登录</a></h3><h3 id="观察源码，选择适当的筛选方法"><a href="#观察源码，选择适当的筛选方法" class="headerlink" title="观察源码，选择适当的筛选方法"></a>观察源码，选择适当的筛选方法</h3><h3 id="写入数据库"><a href="#写入数据库" class="headerlink" title="写入数据库"></a>写入数据库</h3><h2 id="爬虫代码如下："><a href="#爬虫代码如下：" class="headerlink" title="爬虫代码如下："></a>爬虫代码如下：</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#导入程序需要的库</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line"><span class="comment">#链接数据库</span></span><br><span class="line">client = pymongo.MongoClient(<span class="string">'localhost'</span>,<span class="number">27017</span>)</span><br><span class="line"><span class="comment">#创建数据库和数据集合</span></span><br><span class="line">net_speader = client[<span class="string">'net_speader'</span>]</span><br><span class="line">qq_data = net_speader[<span class="string">'qq_data'</span>]</span><br><span class="line"></span><br><span class="line">chrome_options = Options()</span><br><span class="line"><span class="comment">#选择无头chrome，并设置窗口最大化</span></span><br><span class="line">chrome_options.add_argument(<span class="string">'--headless'</span>)</span><br><span class="line">driver = webdriver.Chrome(chrome_options=chrome_options)</span><br><span class="line">driver.maximize_window()</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义获取信息的函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_info</span><span class="params">(qq)</span>:</span></span><br><span class="line">    <span class="comment">#声明变量</span></span><br><span class="line">    <span class="keyword">global</span> time</span><br><span class="line">    <span class="comment">#请求url隐式等待15s</span></span><br><span class="line">    driver.get(<span class="string">'https://user.qzone.qq.com/&#123;&#125;/311'</span>.format(qq))</span><br><span class="line">    driver.implicitly_wait(<span class="number">15</span>)</span><br><span class="line">    <span class="comment">#判断页面是否需要登陆，通过查找是否有ID为login_div的div标签来进行判断</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        driver.find_element_by_id(<span class="string">'login_div'</span>)</span><br><span class="line">        a = <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        a = <span class="keyword">False</span></span><br><span class="line">    <span class="comment">#如果需要登陆则切换到需要登陆的框架进行登陆</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="keyword">True</span>:</span><br><span class="line">        driver.switch_to.frame(<span class="string">'login_frame'</span>)</span><br><span class="line">        driver.find_element_by_id(<span class="string">'switcher_plogin'</span>).click()</span><br><span class="line">        driver.find_element_by_id(<span class="string">'u'</span>).clear()</span><br><span class="line">        driver.find_element_by_id(<span class="string">'u'</span>).send_keys(<span class="string">'你的qq号码'</span>)</span><br><span class="line">        driver.find_element_by_id(<span class="string">'p'</span>).clear()</span><br><span class="line">        driver.find_element_by_id(<span class="string">'p'</span>).send_keys(<span class="string">'你的qq号密码'</span>)</span><br><span class="line">        driver.find_element_by_id(<span class="string">'login_button'</span>).click()</span><br><span class="line">        time.sleep(<span class="number">5</span>)</span><br><span class="line">    driver.implicitly_wait(<span class="number">3</span>)</span><br><span class="line">    <span class="comment">#通过查找是否有ID为QM_OwnerInfo_Icon的div标签来判断是否有权限访问好友的qq空间</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        driver.find_element_by_id(<span class="string">'QM_OwnerInfo_Icon'</span>)</span><br><span class="line">        b = <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        b = <span class="keyword">False</span></span><br><span class="line">    <span class="comment">#如果可以访问则切换到好友说说框架进行数据的爬取和储存</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="keyword">True</span>:</span><br><span class="line">        driver.switch_to.frame(<span class="string">'app_canvas_frame'</span>)</span><br><span class="line">        contents = driver.find_elements_by_css_selector(<span class="string">'.content'</span>)</span><br><span class="line">        times = driver.find_elements_by_css_selector(<span class="string">'.c_tx.c_tx3.goDetail'</span>)</span><br><span class="line">        <span class="keyword">for</span> content,time <span class="keyword">in</span> zip(contents,times):</span><br><span class="line">            data = &#123;</span><br><span class="line">                <span class="string">'time'</span>:time.text,</span><br><span class="line">                <span class="string">'content'</span>:content.text</span><br><span class="line">            &#125;</span><br><span class="line">            print(data)</span><br><span class="line">            qq_data.insert_one(data)</span><br><span class="line"><span class="comment">#主程序入口，通过csv库读取通讯录文件，存入列表</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    qq_lists = []</span><br><span class="line">    fp = open(<span class="string">r'W:\text\qqmail.csv'</span>,encoding=<span class="string">'gb18030'</span>,errors=<span class="string">'ignore'</span>)</span><br><span class="line">    reader = csv.DictReader(fp)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> reader:</span><br><span class="line">        qq_lists.append(row[<span class="string">'qqmail'</span>].split(<span class="string">'@'</span>)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    fp.close()</span><br><span class="line">    print(qq_lists)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> qq_lists:</span><br><span class="line">        get_info(i)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="python" scheme="https://duguangbao.github.io/categories/python/"/>
    
      <category term="爬虫" scheme="https://duguangbao.github.io/categories/python/%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="python" scheme="https://duguangbao.github.io/tags/python/"/>
    
      <category term="爬虫" scheme="https://duguangbao.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="计算机语言" scheme="https://duguangbao.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%AD%E8%A8%80/"/>
    
  </entry>
  
  <entry>
    <title>一路向西</title>
    <link href="https://duguangbao.github.io/2017/07/16/%E4%B8%80%E8%B7%AF%E5%90%91%E8%A5%BF/"/>
    <id>https://duguangbao.github.io/2017/07/16/一路向西/</id>
    <published>2017-07-15T16:00:00.000Z</published>
    <updated>2018-08-20T15:00:27.929Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p class="description"></p><h2 id="写在前面："><a href="#写在前面：" class="headerlink" title="写在前面："></a>写在前面：</h2><p>回想起来已经是上一个暑假的事了，一直想静下来好好写下这次的经历的，但是一直却没有去做，时隔一年，再次回想起来，当时印在脑海里的画面并没有随时间的逝去褪色丝毫，相反，那真实的触动人心的感觉在忙碌的生活中显得更加深刻，更令人回味…</p><h2 id="契机"><a href="#契机" class="headerlink" title="契机"></a>契机</h2><p>其实我一开始想要骑行进藏的愿望并没有那么强烈，高中的时候有一位和我关系挺好的同学(yjl)在班级里讲过自己骑行进藏的故事，当时的也只是感觉挺好玩的而已，后来高中毕业的时候，又有一个朋友(lcm)骑了过去，当时有一些羡慕，倒不是说是因为西藏，只是感觉可以去自己想去的地方真好，在大学里一年尝试了很多新鲜事物，但都无法坚持，慢慢的自己究竟喜欢些什么我自己都不知道了，转眼间又是一个暑假的到来，我意识到自己必须有一个改变，至于要究竟要改变一些什么，我自己也没有想太清楚，我决定去拉萨，骑单车去，我想亲身感受一下那种骑行在云端，努力呼吸每一口新鲜空气的感觉…</p><h2 id="准备出发"><a href="#准备出发" class="headerlink" title="准备出发"></a>准备出发</h2><h3 id="最困难的一步"><a href="#最困难的一步" class="headerlink" title="最困难的一步"></a>最困难的一步</h3><p>学校放假很早，七月初我就回到了家里，在决定骑行川藏线时，我就已经开始一些准备工作，头盔，骑行服，冲锋衣，雨衣，洞洞鞋，车座垫以及每天的有氧运动训练都认真的准备了，此时最大的难处就是说服我的父母，我从未一人去过这么远的地方，再加上我所说的那些朋友都是在网上没聊够几句的，他们不放心也在所难免，我和父母谈了几次，我实在没有想到会是那么的艰难，这和厚着脸皮找二老要钱花是完全不同的事，空气流动的很慢，钟表咔咔的叫着，房间里的灯很暗淡，我看着父亲花白的头发一阵心酸，他同意了，我看得出它有一些无奈，没有什么僵持的局面，母亲也同意了，我决定九号出发。<br>出发前一天晚上，吃完晚饭，母亲和我一起聊天，我们说起未知的行程，她让我多带一些衣服，说赶路的时候不容易干，我说我买了速干衣，之后叮嘱我到了成都看清车牌，不要走错车站，天气不好就买张机票直接到拉萨好好玩几天回来，实在不行就回家好了，我说好，没能说出更多的话，我的心里很不是滋味，我看着母亲，她的身姿有些憔悴，这是岁月而非我的缘故，我很想这样想着，但这个结论很快就被我亲手推翻了，我想起了小时候母亲和爷爷生气他流下过的眼泪还有被我气哭时的情景，那时她眼角还没有这样的沟壑，那时的我也想要好好保护她跟她说不要哭了，但最后不知怎么的我也总是在她身边哭出声来，天上的云霞还没有散去，夜空的星星也并不分明，这一交接时刻我们称之为黄昏，也就是这时她轻轻的问我说能不能不去，他脸上有露出一点点微笑，我看着她，笑着说：好。<br>我们曾在饭桌上，电话里，电视机前谈论多次，每一次的对持我都以胜利告终，然而面对这样一个疑问句我无法拒绝，我感觉得到此时她的微笑就像风中微弱的火苗，而我的拒绝只会让这风更加激烈…<br>我将头盔和衣服整理好放进柜子，反正以后还有机会嘛，我这样告诉自己。<br>之后的两天我一直在想着这件事，好像人就是这样，就如陈奕迅在<a href="https://music.163.com/#/song?id=65533&amp;autoplay=true&amp;market=baiduhd" target="_blank" rel="noopener">红玫瑰</a>里唱的一样得不到的永远在骚动，被偏爱的都有恃无恐，母亲似乎看出了我的心事，说以后什么时候想去以后再去，我点头说好，晚饭的时候我告诉爸妈我还是想要现在去一次，她们同意了，然后招呼我吃饭，继续叮嘱我注意安全之类的，对于我的出尔反尔毫不在意，我想母亲的心路历程大概和我是一样的，都有同样的一个弯道，过去了也就好了<br>之后的事情就相对容易多了，收拾东西，坐车去市里，然后转车去武汉，在之后取票检票到成都，没法带箱子，拎着一个旅行包跌跌撞撞找到了住的地方，虽然有些辛苦但相对来说都不算些什么</p><h3 id="遇见一个可靠的队友"><a href="#遇见一个可靠的队友" class="headerlink" title="遇见一个可靠的队友"></a>遇见一个可靠的队友</h3><p>一开始我们是在微信群里认识的，本来我们都准备十二号出发的，之后因为一些缘故我们两个人都推迟到十六号出发，这也算是一种缘分吧<br>到了成都之后我们有通过电话，本来想一起吃个饭的，但后来我想出去看看成都的夜里也就没能先在一起吃个饭，后来我们一起调试车子，然后一起在周边骑了一圈，但由于路不熟，一会就绕回来了(此处友情提示，不要去骑行旅店里面买自行车，没有优惠也就算了，可能还会坑你，正经专卖店里走一遭才是最好)</p><h2 id="正式启程"><a href="#正式启程" class="headerlink" title="正式启程"></a>正式启程</h2><h3 id="第一天直接累趴"><a href="#第一天直接累趴" class="headerlink" title="第一天直接累趴"></a>第一天直接累趴</h3><p><center> 七月十六日  成都到雅安  共计有六十公里(其实我快到一百七了) </center><br>到成都的这两天经常会突然下雨，临走的这一天早上又下了起来</p>]]></content>
    
    <summary type="html">
    
      我的川藏骑行路
    
    </summary>
    
    
  </entry>
  
</feed>
